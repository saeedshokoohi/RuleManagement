<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head><title>Rule Defenition</title>

</h:head>
<h:outputStylesheet name="css/rm_style.css"/>
<h:outputStylesheet name="codemirror/eclipse.css"/>
<h:outputScript name="codemirror/codemirror.js"/>
<h:outputScript name="codemirror/anyword-hint.js"/>
<h:outputScript name="codemirror/javascript-hint.js"/>
<h:outputScript name="codemirror/show-hint.js"/>
<h:outputScript name="js/rm_rule_editor.js"/>
<h:outputScript name="codemirror/mode/clike/clike.js"/>
<h:outputScript name="codemirror/mode/javascript/javascript.js"/>
<h:outputStylesheet name="codemirror/codemirror.css"/>
<h:outputStylesheet name="codemirror/show-hint.css"/>
<h:body>

    <h:form prependId="false" enctype="multipart/form-data">
        <div id="rm_main_panel">
            <div id="rm_right_panel" class="rm_panel">right</div>
            <div id="rm_center_panel" class="rm_panel">
                <div id="rm_top_toolbar" class="rm_panel">
                    <div class="rm_hpanel">
                        <p:commandButton ajax="false" value="#{msgUtil.getProperty('saveRule')}" icon="ui-icon-disk"
                                         action="#{rawRuleController.save(entity)}"></p:commandButton>

                        <p:commandButton ajax="false" immediate="true" value="#{msgUtil.getProperty('showRuleList')}"
                                         icon="ui-icon-search" action="list"></p:commandButton>
                    </div>
                    <div class="verticalLine" style="height: 30px"></div>
                    <div class="rm_hpanel">
                        <p:commandButton ajax="false" rendered="#{entity.id!=null}"
                                         value="#{msgUtil.getProperty('compileRule')}"
                                         icon="ui-icon-gear"
                                         action="#{rawRuleController.compileRule(entity)}"></p:commandButton>

                        <p:commandButton ajax="false" rendered="#{entity.id!=null}"
                                         value="#{msgUtil.getProperty('publish_rule')}"
                                         icon="ui-icon-signal-diag"
                                         action="#{rawRuleController.publishRule(entity)}"></p:commandButton>
                    </div>
                </div>
                <div id="rm_message_bar">
                    <p:messages id="info">

                    </p:messages>

                    <div class="rm_compileErrors">


                        <h:outputLabel value="#{ruleVM.compileMessage}" escape="false"></h:outputLabel>

                    </div>

                </div>
                <h:inputHidden id="classList" value="#{ruleVM.classList}"/>
                <h:inputHidden id="methodList" value="#{ruleVM.methodList}"/>

                <table>

                    <tr>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('ruleGroup')}" for="ruleGroup"/>
                        </td>
                        <td class="rm_tdinput" >
                            <p:autoComplete id="ruleGroup" style="direction: ltr"  value="#{entity.groupId}"
                                            itemLabel="#{pck}"
                                            itemValue="#{pck}"
                                            forceSelection="false"
                                            required="true"
                                            size="50"
                                            requiredMessage="#{msgUtil.getProperty('required_groupId')}"
                                            completeMethod="#{rawRuleController.completeGroupId}" var="pck"
                                            cache="true"></p:autoComplete>

                        </td>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('rule_name')}" for="txtruleName"/>
                        </td>
                        <td class="rm_tdinput">
                            <p:inputText dir="ltr" id="txtruleName" size="35"
                                         requiredMessage="#{msgUtil.getProperty('required_ruleName')}"
                                         value="#{entity.ruleName}"
                                         required="true"></p:inputText>
                        </td>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('versionNumber')}" for="versionNumber"/>
                        </td>
                        <td class="rm_tdinput">
                            <p:inputText size="10" style="direction: ltr" id="versionNumber" value="#{entity.versionNumber}"></p:inputText>

                        </td>
                    </tr>
                    <tr>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('rule_display_name')}" for="displayName"/>
                        </td>
                        <td class="rm_tdinput">
                            <p:inputText size="50" id="displayName" value="#{entity.ruleDisplayName}"></p:inputText>
                        </td>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('resourceType')}" for="resourceType"/>
                        </td>
                        <td class="rm_tdinput">
                            <p:selectOneMenu style="width: 120px" id="resourceType" value="#{entity.resourceType}">
                                <f:selectItems value="#{ruleVM.resourceTypes}" var="val"
                                               itemLable="#{msgUtil.getProperty(val.label)}"
                                               ></f:selectItems>
                            </p:selectOneMenu>
                        </td>


                    </tr>

                    <tr>
                        <td class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('ruleDescription')}" for="ruleDescription"/>
                        </td>
                        <td colspan="7" style="direction: rtl">
                            <p:inputTextarea id="ruleDescription" value="#{entity.ruleDescription}" cols="130" rows="2">

                            </p:inputTextarea>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="8" class="rm_tdlabel">
                            <p:outputLabel value="#{msgUtil.getProperty('ruleContent')}"/>

                        </td>

                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="5">
                            <p:selectOneRadio id="customRadio" style="float: right;direction: rtl"  value="#{ruleVM.rawRule.ruleContentType}" columns="2" layout="grid">
                                <f:selectItem itemLabel="#{msgUtil.getProperty('rule_from_editor')}" itemValue="TEXT_AS_RULE" />
                                <f:selectItem  itemLabel="#{msgUtil.getProperty('ruleFromFile')}" itemValue="FILE_AS_RULE" />
                                <p:ajax  listener="#{rawRuleController.fileTypeChanged(ruleVM)}" process="@form" update="@form" oncomplete="makeEditorCodeMirror()"/>
                            </p:selectOneRadio>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="8">

                            <h:panelGroup style="direction: rtl;float: right"  rendered="#{ruleVM.fromFile}">
                                <p:fileUpload value="#{ruleVM.ruleFile}"  uploadLabel="#{msgUtil.getProperty('rule_file')}" label="#{msgUtil.getProperty('rule_file')}" required="true" invalidFileMessage="#{msgUtil.getProperty('error_rule_file_type_not_valid')}"
                                              requiredMessage="#{msgUtil.getProperty('required_rule_file')}"

                                              mode="simple" skinSimple="true" allowTypes="/(\.|\/)(drl|gdrl|rdrl|xlsx|xls)$/" />
                                <p:commandButton value="#{msgUtil.getProperty('upload_rule_file')}" ajax="false" actionListener="#{rawRuleController.uploadRuleFile}"  />

                                <p:spacer></p:spacer>

                                <p:commandButton disabled="#{!rawRuleController.canDownloadFile(ruleVM)}" value="#{msgUtil.getProperty('dowload_rule_file')}" ajax="false" actionListener="#{rawRuleController.makeDownloadFile(ruleVM)}" icon="ui-icon-arrowthick-1-s">
                                    <p:fileDownload value="#{ruleVM.ruleFileForDownload}"/>
                                </p:commandButton>


                            </h:panelGroup>
                        </td>
                    </tr>
                    <tr>

                        <td colspan="8" style="direction: ltr">

                           <h:panelGroup rendered="#{!ruleVM.fromFile}">
                            <p:inputTextarea value="#{entity.ruleContentStr}" id="ruleEditorTextArea" cols="150"
                                             rows="20">

                            </p:inputTextarea>
                           </h:panelGroup>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="rm_left_panel" class="rm_panel" style="text-align: left;overflow: hidden">
                <h:panelGrid columns="1">
                    <h:panelGrid columns="3" style="direction: ltr; width: 300px">
                        <p:spacer></p:spacer>
                        <p:autoComplete id="packeages" value="#{ruleVM.selectedPackage}" tabindex="3"
                                        style="font-size: 0.9em" size="30" itemLabel="#{pck}"
                                        itemValue="#{pck}"
                                        completeMethod="#{rawRuleController.completePackageList}" var="pck"
                                        cache="true">
                            <p:ajax event="change" process="@this" update="classes"
                                    listener="#{rawRuleController.packageChanged()}"/>
                            <p:ajax event="itemSelect" process="@this" update="classes"
                                    listener="#{rawRuleController.packageChanged()}"/>
                        </p:autoComplete>
                        <p:outputLabel value="#{msgUtil.getProperty('rulePackage')}" for="packeages"></p:outputLabel>

                        <p:commandButton id="importBtn" tabindex="5" icon="ui-icon-circle-plus" ajax="false"
                                         process="@form" actionListener="#{rawRuleController.importClass(entity)}"
                                         update="@form"
                                         oncomplete=" makeEditorCodeMirror('importBtn');"></p:commandButton>
                        <p:autoComplete tabindex="4" id="classes" value="#{ruleVM.selectedclass}"
                                        style="font-size: 0.9em" size="30" cache="true"
                                        completeMethod="#{rawRuleController.completeClassList}">
                        </p:autoComplete>
                        <p:outputLabel value="#{msgUtil.getProperty('ruleClass')}" for="classes"></p:outputLabel>
                    </h:panelGrid>
                    <h:dataTable value="#{ruleVM.importedClasses}" styleClass="codingStyle"
                                 style="float: left;background-color: #d7d4f0" var="clz">

                        <h:column>
                            <p:commandButton id="UnimportBtn" tabindex="6" icon="ui-icon-circle-minus" ajax="false"
                                             process="@form" actionListener="#{rawRuleController.removeImport(clz)}"
                                             update="@form"></p:commandButton>
                        </h:column>
                        <h:column>
                            <div class="codingStyle">#{clz}</div>
                        </h:column>
                    </h:dataTable>
                </h:panelGrid>
            </div>
        </div>

    </h:form>
</h:body>
</html> 